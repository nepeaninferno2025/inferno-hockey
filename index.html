<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Inferno Nepean Hockey</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="assets/inferno-logo.png" type="image/png">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

const firebaseConfig = {
  apiKey:"AIzaSyCcl7fjelmFRMSNqrNfCTSEJxJcxj7lano",
  databaseURL:"https://infernohockey-b39f9-default-rtdb.firebaseio.com",
  projectId:"infernohockey-b39f9"
};
window.app = initializeApp(firebaseConfig);
window.db = getDatabase(window.app);
</script>

<style>
:root{
  --dark:#0c0c0c;
  --card:#1a1a1a;
  --accent:#ff4500;
  --text:#f2f2f2;
  --highlight:#ff7a3d;
  --danger: #d9534f;
}
*{box-sizing:border-box;}
body{margin:0;font-family:"Segoe UI",Roboto,sans-serif;background:var(--dark);color:var(--text);overflow-x:hidden;}

/* HEADER & BANNER */
header{background:linear-gradient(135deg,#8b0000 0%,#ff4500 100%);padding:20px;position:relative;z-index:10;}
.brand{display:flex;gap:15px;align-items:center;}
.brand img{height:65px;}
.brand h1{margin:0;font-size:26px;letter-spacing:1px;text-transform:uppercase;}
.brand span{font-size:12px;color:#ffd1d1;font-weight:bold;letter-spacing:2px;}

nav{display:flex;gap:8px;margin-top:15px;flex-wrap:wrap;}
nav a{color:#fff;text-decoration:none;font-size:13px;font-weight:600;padding:8px 15px;border-radius:4px;transition:0.2s;cursor:pointer;background:rgba(0,0,0,0.2);}
nav a:hover{background:rgba(255,255,255,0.2);}
nav a.admin{border:1px solid #fff;}

.banner-wrap{background:#000;margin-top:15px;height:35px;display:flex;align-items:center;border:1px solid #333;position:relative;overflow:hidden;}
.banner-label{background:var(--accent);color:#fff;padding:0 15px;height:100%;display:flex;align-items:center;font-weight:bold;font-size:12px;z-index:2;box-shadow:5px 0 15px rgba(0,0,0,0.5);}
.banner-scroll{white-space:nowrap;position:absolute;animation:scrollText 25s linear infinite;display:flex;align-items:center;gap:50px;}
@keyframes scrollText{0%{transform:translateX(100vw);}100%{transform:translateX(-100%);}}

/* NEWS SYSTEM */
.news-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px;}
.news-card{background:var(--card);border-radius:8px;padding:20px;border-top:4px solid var(--accent);transition:0.3s;position:relative;}
.news-card:hover{transform:translateY(-5px);background:#222;}
.news-card h3{margin:0 0 10px 0;color:var(--accent);}
.news-card p{font-size:14px;color:#ccc;line-height:1.5;}
.news-card .news-link{display:inline-block;margin-top:15px;color:var(--highlight);text-decoration:none;font-weight:bold;font-size:13px;}

/* TABLES & CARDS */
main{max-width:1200px;margin:auto;padding:20px;}
section{display:none;}
section.active{display:block;}
.card{background:var(--card);padding:25px;border-radius:12px;margin-bottom:25px;border:1px solid #222;}
h2{margin-top:0;border-left:5px solid var(--accent);padding-left:15px;font-size:22px;text-transform:uppercase;}

table{width:100%;border-collapse:collapse;}
th,td{padding:12px;text-align:center;border-bottom:1px solid #2a2a2a;}
th{background:#111;color:var(--accent);font-size:12px;text-transform:uppercase;}

/* ADMIN UI */
.admin-controls{margin-top:20px;display:none;background:#111;padding:15px;border-radius:8px;}
input,textarea,button{width:100%;padding:10px;margin-top:10px;border-radius:4px;border:1px solid #333;background:#050505;color:#fff;}
button{background:var(--accent);border:none;font-weight:bold;cursor:pointer;text-transform:uppercase;}
button:hover{background:var(--highlight);}
.btn-sm{width:auto;display:inline-block;padding:5px 10px;font-size:11px;margin:2px;}
.edit-btn{background:#555;}
.del-btn{background:var(--danger);}

.footer{text-align:center;padding:40px;color:#555;font-size:12px;}
</style>
</head>
<body>

<header>
  <div class="brand">
    <img src="assets/inferno-logo.png" alt="Inferno Logo">
    <div>
      <h1>Inferno Nepean</h1>
      <span>LOYALTY â€¢ TRUST â€¢ COMMITMENT</span>
    </div>
  </div>
  <nav>
    <a onclick="show('news')">News</a>
    <a onclick="show('roster')">Roster</a>
    <a onclick="show('league')">Standings</a>
    <a onclick="show('schedule')">Games</a>
    <a onclick="show('record')">Record</a>
    <a class="admin" onclick="show('admin')">Admin</a>
    <a id="logoutBtn" style="display:none; color:yellow" onclick="logout()">Logout</a>
  </nav>
  
  <div class="banner-wrap">
    <div class="banner-label">UPCOMING GAMES</div>
    <div class="banner-scroll" id="bannerText">Checking schedule for upcoming matches...</div>
  </div>
</header>

<main>
  <section id="news" class="active">
    <div class="card">
      <h2>Team News & Announcements</h2>
      <div id="newsGrid" class="news-grid"></div>
      
      <div class="admin-controls admin-only">
        <h3>Add News Article</h3>
        <input id="newsTitle" placeholder="Article Title">
        <textarea id="newsContent" placeholder="Article Content"></textarea>
        <input id="newsLink" placeholder="Link (Optional)">
        <button onclick="saveNews()">Publish Article</button>
      </div>
    </div>
  </section>

  <section id="schedule">
    <div class="card">
      <h2>Game Schedule</h2>
      <table>
        <thead><tr><th>Date</th><th>Opponent</th><th>Location</th><th>Score</th><th class="admin-only">Actions</th></tr></thead>
        <tbody id="scheduleBody"></tbody>
      </table>
      <div class="admin-controls admin-only">
        <input id="schedInput" placeholder="Date | Opponent | Location | Score (Leave blank if upcoming)">
        <button onclick="save('schedule')">Add Game</button>
      </div>
    </div>
  </section>

  <section id="roster">
    <div class="card">
      <h2>Player Roster</h2>
      <table id="rosterTable">
        <thead><tr><th>Name</th><th>Pos</th><th>#</th><th>G</th><th>A</th><th>P</th><th class="admin-only">Actions</th></tr></thead>
        <tbody id="rosterBody"></tbody>
      </table>
      <div class="admin-controls admin-only">
        <input id="rosterInput" placeholder="Name | Pos | # | G | A | P">
        <button onclick="save('roster')">Add Player</button>
      </div>
    </div>
  </section>

  <section id="league">
    <div class="card">
      <h2>League Standings</h2>
      <table>
        <thead><tr><th>Team</th><th>GP</th><th>W</th><th>L</th><th>T</th><th>PTS</th><th class="admin-only">Actions</th></tr></thead>
        <tbody id="leagueBody"></tbody>
      </table>
      <div class="admin-controls admin-only">
        <input id="leagueInput" placeholder="Team | GP | W | L | T | PTS">
        <button onclick="save('league')">Add Standing</button>
      </div>
    </div>
  </section>

  <section id="record">
    <div class="card">
      <h2>Season Record</h2>
      <div style="text-align:center; font-size:40px; font-weight:900; color:var(--accent); margin-bottom:20px;" id="recordDisplay">0-0-0</div>
      <table>
        <thead><tr><th>Season</th><th>W-L-T</th><th class="admin-only">Actions</th></tr></thead>
        <tbody id="recordBody"></tbody>
      </table>
      <div class="admin-controls admin-only">
        <input id="recordInput" placeholder="Season Name | W-L-T">
        <button onclick="save('record')">Update Record</button>
      </div>
    </div>
  </section>

  <section id="admin">
    <div class="card">
      <h2>Admin Login</h2>
      <input id="user" placeholder="Username">
      <input id="pass" type="password" placeholder="Password">
      <button onclick="login()">Login</button>
    </div>
  </section>
</main>

<div class="footer">&copy; 2025 Inferno Nepean Hockey</div>

<script type="module">
import { ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";
const db = window.db;
let isAdmin = false;

// Navigation
window.show = id => {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

// Admin Auth
window.login = () => {
  if(user.value === "athenadmin" && pass.value === "AthFon32") {
    isAdmin = true;
    document.querySelectorAll(".admin-only").forEach(e => e.style.display = "block");
    logoutBtn.style.display = "inline-block";
    renderAll();
    alert("Admin Mode Active");
  } else { alert("Login Failed"); }
};

window.logout = () => {
  isAdmin = false;
  location.reload();
};

// Unified Table Data Handler
function renderTable(key, bodyId, cols) {
  onValue(ref(db, key), snap => {
    const body = document.getElementById(bodyId);
    if(!body) return;
    body.innerHTML = "";
    const data = snap.val() || {};
    
    Object.keys(data).forEach(id => {
      const parts = data[id].split("|").map(p => p.trim());
      const tr = document.createElement("tr");
      tr.innerHTML = parts.map(p => `<td>${p}</td>`).join("");
      
      if(key === 'record') document.getElementById('recordDisplay').innerText = parts[1];

      if(isAdmin) {
        const actionTd = document.createElement("td");
        actionTd.innerHTML = `<button class="btn-sm edit-btn" onclick="editRow('${key}','${id}')">Edit</button>
                              <button class="btn-sm del-btn" onclick="deleteRow('${key}','${id}')">X</button>`;
        tr.appendChild(actionTd);
      }
      body.appendChild(tr);
    });
  });
}

// News System Handler
function renderNews() {
  onValue(ref(db, "news"), snap => {
    const grid = document.getElementById("newsGrid");
    grid.innerHTML = "";
    const data = snap.val() || {};
    Object.keys(data).forEach(id => {
      const [title, content, link] = data[id].split("|").map(p => p.trim());
      const card = document.createElement("div");
      card.className = "news-card";
      card.innerHTML = `
        <h3>${title}</h3>
        <p>${content}</p>
        ${link ? `<a href="${link}" target="_blank" class="news-link">Read More â†’</a>` : ''}
        ${isAdmin ? `<div style="margin-top:10px">
          <button class="btn-sm edit-btn" onclick="editNews('${id}','${title}','${content}','${link}')">Edit</button>
          <button class="btn-sm del-btn" onclick="deleteRow('news','${id}')">Delete</button>
        </div>` : ''}
      `;
      grid.appendChild(card);
    });
  });
}

// Banner Handler (Games Only)
function renderBanner() {
  onValue(ref(db, "schedule"), snap => {
    const games = snap.val() || {};
    let tickerText = "";
    Object.keys(games).forEach(id => {
      const g = games[id].split("|").map(p => p.trim());
      // Only show in banner if there is no score yet (Upcoming)
      if(!g[3] || g[3].toLowerCase() === "tbd") {
        tickerText += `ðŸ’ ${g[0]} vs ${g[1]} (${g[2]}) &nbsp;&nbsp;&nbsp;&nbsp; `;
      }
    });
    document.getElementById("bannerText").innerHTML = tickerText || "No upcoming games scheduled.";
  });
}

// Logic for Saving
window.save = (key) => {
  const val = document.getElementById(key + "Input").value;
  if(!val) return;
  set(ref(db, key + "/" + Date.now()), val);
  document.getElementById(key + "Input").value = "";
};

window.saveNews = () => {
  const title = newsTitle.value;
  const content = newsContent.value;
  const link = newsLink.value || "";
  if(!title || !content) return;
  set(ref(db, "news/" + Date.now()), `${title}|${content}|${link}`);
  newsTitle.value = ""; newsContent.value = ""; newsLink.value = "";
};

window.deleteRow = (key, id) => { if(confirm("Delete this?")) remove(ref(db, key + "/" + id)); };

window.editRow = (key, id) => {
  const newVal = prompt("Edit Data (Use | to separate columns):");
  if(newVal) set(ref(db, key + "/" + id), newVal);
};

window.editNews = (id, t, c, l) => {
    const nT = prompt("Edit Title:", t);
    const nC = prompt("Edit Content:", c);
    const nL = prompt("Edit Link:", l);
    if(nT && nC) set(ref(db, "news/" + id), `${nT}|${nC}|${nL}`);
};

function renderAll() {
  renderNews();
  renderTable("roster", "rosterBody", 6);
  renderTable("league", "leagueBody", 6);
  renderTable("schedule", "scheduleBody", 4);
  renderTable("record", "recordBody", 2);
  renderBanner();
}

renderAll();
</script>
</body>
</html>
